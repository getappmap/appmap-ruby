language: ruby
dist: bionic

# NB: if you update the ruby versions here, you also need to update
# them in the Rakefile.
rbenv:
- 2.6
- 2.7
- 3.0
- 3.1

services:
- postgresql

before_install:
  - |
    nvm install --lts \
      && nvm use --lts \
      && npm i -g yarn

before_deploy:
  - |
    npm i -g \
      semantic-release \
      @semantic-release/git \
      @semantic-release/changelog \
      semantic-release-rubygem

deploy:
  - provider: script
    script: ./release.sh
    on:
      branch: master
      condition: "$TRAVIS_RUBY_VERSION = 3.0"
